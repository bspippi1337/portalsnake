<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Snake</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        /* --- START CSS --- */
        :root {
            --grid-size: 20; /* Antall ruter på en side (f.eks. 20x20) */
            --cell-size: 20px; /* Størrelsen på hver rute */
            --primary-neon: #00ffcc; /* Cyan */
            --secondary-neon: #ff00ff; /* Magenta */
            --accent-neon: #ffff00; /* Gul */
            --background-dark: #1a1a2e;
            --border-dark: #0f0f1d;
            --text-color: #e0e0e0;
        }

        body {
            font-family: 'Share Tech Mono', monospace; /* "Techy" font */
            background-color: var(--background-dark);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Skjuler scrollbars */
            text-shadow: 0 0 5px var(--primary-neon);
        }

        .game-container {
            display: flex;
            flex-direction: column;
            border: 3px solid var(--primary-neon);
            box-shadow: 0 0 15px var(--primary-neon), inset 0 0 10px var(--primary-neon);
            padding: 20px;
            background-color: var(--border-dark);
            max-width: calc(var(--grid-size) * var(--cell-size) + 80px); /* Juster basert på grid + padding */
            position: relative;
            animation: pulseBorder 2s infinite alternate;
        }

        @keyframes pulseBorder {
            from { box-shadow: 0 0 10px var(--primary-neon), inset 0 0 7px var(--primary-neon); }
            to { box-shadow: 0 0 25px var(--primary-neon), inset 0 0 15px var(--primary-neon); }
        }

        .header-display, .footer-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px dashed var(--secondary-neon);
            border-top: 1px dashed var(--secondary-neon);
        }

        .footer-display {
            margin-top: 20px;
            margin-bottom: 0;
            border-bottom: none;
            border-top: 1px dashed var(--secondary-neon);
        }

        .logo {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-neon);
            text-shadow: 0 0 10px var(--accent-neon);
        }

        .status-message {
            font-size: 1.1em;
            color: var(--primary-neon);
            animation: blinkText 1s infinite steps(1, start);
        }

        @keyframes blinkText {
            50% { opacity: 0; }
        }

        .score-panel, .controls, .error-log {
            font-size: 1em;
            color: var(--text-color);
        }

        .score-panel #score {
            color: var(--secondary-neon);
            text-shadow: 0 0 5px var(--secondary-neon);
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(var(--grid-size), var(--cell-size));
            grid-template-rows: repeat(var(--grid-size), var(--cell-size));
            width: calc(var(--grid-size) * var(--cell-size));
            height: calc(var(--grid-size) * var(--cell-size));
            background-color: #0d0d18; /* Mørkere bakgrunn for spillet */
            border: 2px solid var(--secondary-neon);
            box-shadow: 0 0 10px var(--secondary-neon), inset 0 0 5px var(--secondary-neon);
            position: relative;
        }

        .grid-cell {
            width: var(--cell-size);
            height: var(--cell-size);
            box-sizing: border-box;
            /* Simulerer rutenett */
            border-right: 1px dotted rgba(0, 255, 204, 0.1);
            border-bottom: 1px dotted rgba(0, 255, 204, 0.1);
        }
        .grid-cell:nth-child(var(--grid-size)n) { border-right: none; }
        .grid-cell:nth-last-child(-n + var(--grid-size)) { border-bottom: none; }

        /* Slangekropp */
        .snake-body {
            background-color: var(--primary-neon);
            border: 1px solid rgba(0, 255, 204, 0.8);
            box-shadow: 0 0 8px var(--primary-neon), inset 0 0 4px var(--primary-neon);
            animation: neonGlow 1.5s infinite alternate;
            transition: background-color 0.1s ease-out, box-shadow 0.1s ease-out;
        }

        /* Slangehode */
        .snake-head {
            background-color: var(--accent-neon);
            border: 1px solid rgba(255, 255, 0, 0.8);
            box-shadow: 0 0 10px var(--accent-neon), inset 0 0 5px var(--accent-neon);
            animation: headGlow 0.8s infinite alternate;
        }

        @keyframes neonGlow {
            from { box-shadow: 0 0 5px var(--primary-neon), inset 0 0 2px var(--primary-neon); }
            to { box-shadow: 0 0 12px var(--primary-neon), inset 0 0 6px var(--primary-neon); }
        }

        @keyframes headGlow {
            from { box-shadow: 0 0 7px var(--accent-neon), inset 0 0 3px var(--accent-neon); }
            to { box-shadow: 0 0 15px var(--accent-neon), inset 0 0 8px var(--accent-neon); }
        }

        /* Mat */
        .food {
            background-color: var(--secondary-neon);
            border: 1px solid rgba(255, 0, 255, 0.8);
            box-shadow: 0 0 10px var(--secondary-neon), inset 0 0 5px var(--secondary-neon);
            border-radius: 50%; /* Rund matbit */
            animation: foodPulse 0.6s infinite alternate;
        }

        @keyframes foodPulse {
            from { transform: scale(0.8); opacity: 0.7; }
            to { transform: scale(1.1); opacity: 1; }
        }

        /* Game Over-skjerm */
        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            color: var(--accent-neon);
            text-shadow: 0 0 20px var(--accent-neon);
            z-index: 100;
            animation: fadeIn 0.5s ease-out;
            opacity: 0; /* Starter skjult */
            pointer-events: none;
        }

        .game-over-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .game-over-overlay button {
            background-color: var(--primary-neon);
            color: var(--background-dark);
            border: 2px solid var(--accent-neon);
            padding: 10px 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 1em;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary-neon);
            transition: all 0.2s ease-in-out;
        }

        .game-over-overlay button:hover {
            background-color: var(--accent-neon);
            color: var(--background-dark);
            box-shadow: 0 0 15px var(--accent-neon);
            transform: scale(1.05);
        }

        /* "Glitch"-effekt for Game Over-teksten */
        .glitch {
            animation: glitch 1.5s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        /* --- SLUTT CSS --- */
    </style>
</head>
<body>

    <div class="game-container">
        <div class="header-display">
            <div class="logo">CYBER SNAKE //</div>
            <div class="status-message" id="statusMessage">SYSTEM BOOTING...</div>
            <div class="score-panel">SCORE: <span id="score">0</span></div>
        </div>

        <div class="game-grid" id="gameGrid">
            </div>

        <div class="footer-display">
            <div class="controls">USE ARROW KEYS OR WASD //</div>
            <div class="error-log" id="errorLog">LOG: AWAITING INPUT</div>
        </div>
    </div>

    <script>
        // --- START JAVASCRIPT ---

        // --- DOM-elementer ---
        const gameGrid = document.getElementById('gameGrid');
        const scoreElement = document.getElementById('score');
        const statusMessage = document.getElementById('statusMessage');
        const errorLog = document.getElementById('errorLog');

        // --- Spillinnstillinger ---
        const gridSize = 20; // Må matche --grid-size i CSS
        const gameSpeed = 150; // Millisekunder per ramme (lavere = raskere)
        let score = 0;
        let snake = [];
        let food = {};
        let dx = 0; // Retning X (1, -1, 0)
        let dy = 0; // Retning Y (1, -1, 0)
        let gameLoopInterval;
        let gameStarted = false;
        let changingDirection = false;

        // --- Initialiser spillet ---
        function initGame() {
            score = 0;
            scoreElement.textContent = score;
            snake = [{ x: 10, y: 10 }]; // Start i midten
            dx = 0;
            dy = 0;
            gameStarted = false;
            changingDirection = false;
            statusMessage.textContent = "SYSTEM BOOTING...";
            errorLog.textContent = "LOG: AWAITING INPUT";

            createGrid();
            generateFood();
            drawGame();
            if (gameLoopInterval) clearInterval(gameLoopInterval); // Fjern gamle intervaller
        }

        // Lag det visuelle rutenettet (div-elementer)
        function createGrid() {
            gameGrid.innerHTML = ''; // Tøm eksisterende rutenett
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement('div');
                cell.classList.add('grid-cell');
                gameGrid.appendChild(cell);
            }
        }

        // Hent en spesifikk celle med koordinater
        function getCell(x, y) {
            if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) {
                return null; // Utenfor brettet
            }
            return gameGrid.children[y * gridSize + x];
        }

        // Tegn slangen og maten på rutenettet
        function drawGame() {
            // Tøm forrige tegning
            Array.from(gameGrid.children).forEach(cell => {
                cell.classList.remove('snake-body', 'snake-head', 'food');
            });

            // Tegn slangen
            snake.forEach((part, index) => {
                const cell = getCell(part.x, part.y);
                if (cell) {
                    cell.classList.add('snake-body');
                    if (index === 0) { // Hode
                        cell.classList.add('snake-head');
                    }
                }
            });

            // Tegn mat
            const foodCell = getCell(food.x, food.y);
            if (foodCell) {
                foodCell.classList.add('food');
            }
        }

        // Generer ny matposisjon
        function generateFood() {
            let newFoodPos;
            let collisionWithSnake;

            do {
                newFoodPos = {
                    x: Math.floor(Math.random() * gridSize),
                    y: Math.floor(Math.random() * gridSize)
                };
                collisionWithSnake = snake.some(part => part.x === newFoodPos.x && part.y === newFoodPos.y);
            } while (collisionWithSnake); // Prøv på nytt hvis maten er på slangen

            food = newFoodPos;
        }

        // Flytt slangen
        function moveSnake() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // Sjekk for kollisjoner
            if (isCollision(head)) {
                gameOver();
                return;
            }

            snake.unshift(head); // Legg til nytt hode

            // Sjekk om mat ble spist
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreElement.textContent = score;
                statusMessage.textContent = `DATA PACKET ACQUIRED! (+1)`;
                generateFood();
            } else {
                snake.pop(); // Fjern halen (hvis ingen mat ble spist)
            }
            changingDirection = false;
        }

        // Sjekk for vegg- eller selv-kollisjon
        function isCollision(head) {
            // Veggkollisjon
            if (head.x < 0 || head.x >= gridSize || head.y < 0 || head.y >= gridSize) {
                errorLog.textContent = `ERROR 404: WALL_BREACH_DETECTED (X:${head.x}, Y:${head.y})`;
                return true;
            }

            // Selvkollisjon
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    errorLog.textContent = `ERROR 502: SELF_TERMINATION_PROTOCOL_ACTIVATED`;
                    return true;
                }
            }
            return false;
        }

        // Hovedspill-løkke
        function mainGameLoop() {
            moveSnake();
            drawGame();
        }

        // Håndter Game Over
        function gameOver() {
            clearInterval(gameLoopInterval);
            const gameOverOverlay = document.createElement('div');
            gameOverOverlay.classList.add('game-over-overlay');
            gameOverOverlay.innerHTML = `
                <div class="glitch">GAME OVER //</div>
                <div class="glitch-score">FINAL SCORE: ${score}</div>
                <button id="restartButton">REBOOT SYSTEM</button>
            `;
            gameGrid.appendChild(gameOverOverlay);
            setTimeout(() => gameOverOverlay.classList.add('visible'), 10); // Fade inn

            document.getElementById('restartButton').addEventListener('click', () => {
                gameOverOverlay.classList.remove('visible');
                setTimeout(() => gameGrid.removeChild(gameOverOverlay), 500); // Fjern etter fade ut
                initGame();
            });

            statusMessage.textContent = `SYSTEM HALTED. SCORE: ${score}`;
        }

        // Håndter tastetrykk for retning
        function changeDirection(event) {
            if (changingDirection) return;
            changingDirection = true;

            const keyPressed = event.key;
            const goingUp = (dy === -1);
            const goingDown = (dy === 1);
            const goingLeft = (dx === -1);
            const goingRight = (dx === 1);

            // Start spillet på første tastetrykk
            if (!gameStarted && (keyPressed.startsWith('Arrow') || ['w', 'a', 's', 'd'].includes(keyPressed.toLowerCase()))) {
                gameStarted = true;
                gameLoopInterval = setInterval(mainGameLoop, gameSpeed);
                statusMessage.textContent = "SYSTEM ONLINE // AWAITING COMMANDS";
                errorLog.textContent = "LOG: GAME INITIALIZED";
            }

            if ((keyPressed === 'ArrowLeft' || keyPressed.toLowerCase() === 'a') && !goingRight) {
                dx = -1; dy = 0;
                errorLog.textContent = `LOG: DIRECTION LEFT`;
            } else if ((keyPressed === 'ArrowUp' || keyPressed.toLowerCase() === 'w') && !goingDown) {
                dx = 0; dy = -1;
                errorLog.textContent = `LOG: DIRECTION UP`;
            } else if ((keyPressed === 'ArrowRight' || keyPressed.toLowerCase() === 'd') && !goingLeft) {
                dx = 1; dy = 0;
                errorLog.textContent = `LOG: DIRECTION RIGHT`;
            } else if ((keyPressed === 'ArrowDown' || keyPressed.toLowerCase() === 's') && !goingUp) {
                dx = 0; dy = 1;
                errorLog.textContent = `LOG: DIRECTION DOWN`;
            }
        }

        // --- Event Listeners ---
        document.addEventListener('keydown', changeDirection);

        // --- Start spillet for første gang ---
        initGame();

        // --- SLUTT JAVASCRIPT ---
    </script>
</body>
</html>
